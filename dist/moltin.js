!function(t,e,n){"use strict";e="default"in e?e.default:e,n="default"in n?n.default:n;var o=function(t){this.clientId=t.publicId,this.clientSecret=t.secretKey,this.host="api-dev.moltin.com",this.port="443",this.protocol="http",this.version="v2",this.debug=!1,this.currency=t.currency,this.language=!1,this.timeout=6e4,this.contentType="application/json",this.auth={expires:3600,uri:"oauth/access_token"},this.methods=["GET","POST","PUT","DELETE"]},r=function(){if("undefined"==typeof localStorage||null===localStorage){var t=require("node-localstorage").LocalStorage;this.localStorage=new t("./localStorage")}else this.localStorage=window.localStorage};r.prototype.set=function(t,e){return this.localStorage.setItem(t,e)},r.prototype.get=function(t){return this.localStorage.getItem(t)},r.prototype.delete=function(t){return this.localStorage.removeItem(t)};var i=function(t){this.config=t,this.storage=new r};i.prototype.authenticate=function(){var t=this.config,o=this.storage;if(t.clientId.length<=0)throw new Error("You must have a client id set");var r={grant_type:t.clientSecret?"client_credentials":"implicit",client_id:t.clientId};t.clientSecret&&(r.client_secret=t.clientSecret);var i=new n(function(n,o){e(t.protocol+"://"+t.host+"/"+t.auth.uri,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object.keys(r).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(r[t])}).join("&")}).then(function(t){if(200===t.status){var e=t.json();n(e)}}).then(null,function(t){return o(t)})});return i.then(function(t){o.set("mtoken",t.access_token),o.set("mexpires",t.expires)}),i},i.prototype.send=function(t,o,r){var i=this,s=this.config,c=this.storage,u=new n(function(n,u){var p=function(){var i={Authorization:"Bearer: "+c.get("mtoken"),"Content-Type":s.contentType};s.currency&&(i["X-MOLTIN-CURRENCY"]=s.currency),"POST"!==o&&"PUT"!==o||(r='{"data":'+JSON.stringify(r)+"}"),e(s.protocol+"://"+s.host+"/"+s.version+"/"+t,{method:o.toUpperCase(),headers:i,body:r}).then(function(t){n(t.json())}).catch(function(t){return u(t)})};return!c.get("mtoken")||Date.now().toString()>=c.get("mexpires")?i.authenticate().then(p).catch(function(t){return u(t)}):void p()});return u};var s=function(t){this.request=new i(t),this.config=t};s.prototype.Get=function(t,e){if("carts"===this.endpoint)return this.request.send(this.endpoint+"/"+this.cartId,"GET");if(e){var n=e.toString();return this.request.send(this.endpoint+"/"+t+"?include="+n,"GET")}return this.request.send(this.endpoint+"/"+t,"GET")},s.prototype.List=function(t){if(t){var e=t.toString();return this.request.send(this.endpoint+"?include="+e,"GET")}return this.request.send(""+this.endpoint,"GET")};var c=function(t){function e(e){t.call(this,e),this.endpoint="products"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(s),u=function(t){function e(e){t.call(this,e),this.endpoint="currencies",this.storage=new r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Set=function(t){var e=this.storage,o=this.config;e.set("mcurrency",t),o.currency=t;var r=new n(function(t,n){var o=e.get("mcurrency");try{t(o)}catch(t){n(new Error(t))}});return r},e.prototype.Active=function(){var t=this.storage,e=new n(function(e,n){var o=t.get("mcurrency");try{e(o)}catch(t){n(new Error(t))}});return e},e}(s),p=function(t){function e(e){t.call(this,e),this.endpoint="brands"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(s),a=function(t){function e(e){t.call(this,e),this.endpoint="carts",this.storage=new r,this.cartId=this.identifier()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.identifier=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var n=this.storage;return t||e||null===n.get("mcart")?(e||(e="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)})),n.set("mcart",e),e):n.get("mcart")},e.prototype.Contents=function(){return this.request.send(this.endpoint+"/"+this.cartId+"/items","GET")},e.prototype.Insert=function(t,e){var n={id:t,quantity:parseInt(e)||1};return this.request.send(this.endpoint+"/"+this.cartId+"/items","POST",n)},e.prototype.Remove=function(t){return this.request.send(this.endpoint+"/"+this.cartId+"/items/"+t,"DELETE")},e.prototype.Quantity=function(t,e){var n={quantity:parseInt(e)};return this.request.send(this.endpoint+"/"+this.cartId+"/items/"+t,"PUT",n)},e.prototype.Complete=function(t){return this.request.send(this.endpoint+"/"+this.cartId+"/checkout","POST",t)},e.prototype.Delete=function(){return this.request.send(this.endpoint+"/"+this.cartId,"DELETE")},e}(s),h=function(t){function e(e){t.call(this,e),this.endpoint="categories"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Tree=function(){return this.request.send(this.endpoint+"/tree","GET")},e}(s),d=function(t){function e(e){t.call(this,e),this.endpoint="collections"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(s),l=function(t){function e(e){t.call(this,e),this.endpoint="orders"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Payment=function(t,e){return this.request.send(this.endpoint+"/"+t+"/payments","POST",e)},e}(s),f=function(t){this.config=t,this.request=new i(t),this.storage=new r,this.Products=new c(t),this.Currencies=new u(t),this.Brands=new p(t),this.Cart=new a(t),this.Categories=new h(t),this.Collections=new d(t),this.Orders=new l(t)};f.prototype.Authenticate=function(){return this.request.authenticate()};var y=function(t){return new f(new o(t))};t.gateway=y}(this.moltin=this.moltin||{},fetch,Promise);
//# sourceMappingURL=moltin.js.map
