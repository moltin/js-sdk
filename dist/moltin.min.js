/*! moltin (js) minified - v1.0.4 - 2016-09-26 */
"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function __in__(a,b){return b.indexOf(a)>=0}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Moltin=function(){function a(b){return _classCallCheck(this,a),this.config={clientId:"umRG34nxZVGIuCSPfYf8biBSvtABgTR8GMUtflyE",host:"api.molt.in",port:"443",protocol:"https",version:"v1",debug:!1,currency:!1,language:!1,timeout:6e4,contentType:"application/json",auth:{expires:3600,uri:"oauth/access_token"},methods:["GET","POST","PUT","DELETE"]},this.Helper=new HelperFactory,this.config=this.Helper.Merge(this.config,b),this.Storage=new StorageFactory(this),this.RequestFactory=new RequestFactory(this),this.Products=new Products(this),this.Storage.get("mcurrency")&&(this.config.currency=this.Storage.get("mcurrency")),this.Storage.get("mlanguage")&&(this.config.language=this.Storage.get("mlanguage")),this}return _createClass(a,[{key:"Authenticate",value:function(){if(this.config.clientId.length<=0)throw new Error("You must have a client id set");var a={grant_type:"implicit",client_id:this.config.clientId},b={"Content-Type":"application/x-www-form-urlencoded"},c=this.RequestFactory,d=this.Storage,e=this.config,f=new Promise(function(f,g){return c.make(e.auth.uri,"POST",a,b).then(function(a){return d.set("mexpires",a.expires),d.set("mtoken",a.access_token),f(a)}).catch(function(a){return g(a)})});return f}},{key:"Request",value:function(a,b,c){var d=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],e=this.RequestFactory,f=this.Storage,g=this,h=new Promise(function(h,i){var j=function(){var g=f.get("mtoken");return d.Authorization="Bearer: "+g,e.make(a,b,c,d).then(function(a){return h(a)}).catch(function(a){return i(a)})};return f.get("mtoken")?void j():g.Authenticate().then(function(a){return h(a)}).catch(function(a){return i(a)})});return h}}]),a}(),Abstract=function(){function a(b){_classCallCheck(this,a),this.m=b}return _createClass(a,[{key:"Get",value:function(a,b,c){return this.m.Request(this.endpoint+"/"+a,"GET",null,b,c)}},{key:"Find",value:function(a,b,c){return this.m.Request(this.endpoint,"GET",a,b,c)}},{key:"List",value:function(a){return this.m.Request(this.endpoint,"GET",a)}},{key:"Fields",value:function(a,b){var c=0,d=this.endpoint+"/"+(0!==c?c+"/fields":"fields");return this.m.Request(d,"GET",null,a,b)}}]),a}(),Products=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.endpoint="products",c}return _inherits(b,a),_createClass(b,[{key:"Search",value:function(a,b,c){return this.m.Request(this.endpoint+"/search","GET",a,b,c)}},{key:"Modifiers",value:function(a,b,c){return this.m.Request(this.endpoint+"/"+a+"/modifiers","GET",null,b,c)}},{key:"Variations",value:function(a,b,c){return this.m.Request(this.endpoint+"/"+a+"/variations","GET",null,b,c)}}]),b}(Abstract),HelperFactory=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"Merge",value:function(a,b){var c={};for(var d in a){var e=a[d];c[d]=e}for(d in b){var e=b[d];c[d]=e}return c}},{key:"InArray",value:function(a,b){return!(!b||!__in__(a,b))}},{key:"Serialize",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?null:arguments[1],c=[];for(var d in a){var e=a[d];d=null!==b?b+"["+d+"]":d,c.push("object"===("undefined"==typeof e?"undefined":_typeof(e))?this.Serialize(e,d):encodeURIComponent(d)+"="+encodeURIComponent(e))}return c.join("&")}},{key:"Error",value:function(a){var b="";if("undefined"!=typeof a.errors)for(var c in a.errors){var d=a.errors[c];b+=d+"<br />"}else b=a.error;return this.options.notice("Error",b)}}]),a}(),RequestFactory=function(){function a(b){_classCallCheck(this,a),this.driver=!1,this.m=b;try{this.driver=new XMLHttpRequest}catch(a){try{this.driver=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){throw new Error("Request factory boot failed")}}return this}return _createClass(a,[{key:"make",value:function(a,b,c,d){var e=this;b=b.toUpperCase();var f=this.m.config.protocol+"://"+this.m.config.host+("oauth/access_token"!==a?"/"+this.m.config.version+"/"+a:"/"+a);"GET"===b?(f+="?"+this.m.Helper.Serialize(c),c=null):c=this.m.Helper.Serialize(c),this.driver.open(b,f,!0);var g=setTimeout(function(){return e.driver.abort(),e.driver.error(e.driver,408,"Your request timed out")},this.m.config.timeout);for(var h in d){var i=d[h];this.driver.setRequestHeader(h,i)}var j=this.driver,k=new Promise(function(a,b){return j.onreadystatechange=function(){if(4!==j.readyState)return null;clearTimeout(g);try{var c=JSON.parse(j.responseText);return a(c)}catch(a){return b(new Error(a))}}});return this.driver.send(c),k}}]),a}(),StorageFactory=function(){function a(b){_classCallCheck(this,a),this.m=b}return _createClass(a,[{key:"set",value:function(a,b){return window.localStorage.setItem(a,b)}},{key:"get",value:function(a){return window.localStorage.getItem(a)}},{key:"delete",value:function(a){return window.localStorage.removeItem(a)}}]),a}();
//# sourceMappingURL=moltin.min.map