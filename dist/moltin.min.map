{"version":3,"sources":["moltin.js"],"names":["Moltin","__hasProp","hasOwnProperty","__extends","child","parent","ctor","this","constructor","key","call","prototype","__super__","__indexOf","indexOf","item","i","l","length","options","Helper","HelperFactory","config","Merge","Storage","StorageFactory","RequestFactory","Products","get","currency","language","Abstract","clientId","host","port","protocol","version","debug","timeout","contentType","auth","expires","uri","methods","Authenticate","c","data","headers","promise","r","s","Error","grant_type","client_id","Content-Type","Promise","resolve","reject","make","then","set","access_token","error","Request","method","token","Date","now","m","Get","id","callback","endpoint","Find","terms","List","Fields","_super","apply","arguments","Search","Modifiers","Variations","o1","o2","k","o3","v","InArray","arr","Serialize","obj","prefix","str","push","encodeURIComponent","join","response","msg","_ref","errors","notice","e","driver","XMLHttpRequest","_error","ActiveXObject","url","toUpperCase","open","setTimeout","_this","abort","setRequestHeader","onreadystatechange","err","json","readyState","clearTimeout","JSON","parse","responseText","send","value","window","localStorage","setItem","getItem","removeItem"],"mappings":";AAAA,GAAIA,QACFC,aAAeC,eACfC,UAAY,SAASC,EAAOC,GAAiG,QAASC,KAASC,KAAKC,YAAcJ,EAA5H,IAAK,GAAIK,KAAOJ,GAAcJ,UAAUS,KAAKL,EAAQI,KAAML,EAAMK,GAAOJ,EAAOI,GAA2J,OAArGH,GAAKK,UAAYN,EAAOM,UAAWP,EAAMO,UAAY,GAAIL,GAAQF,EAAMQ,UAAYP,EAAOM,UAAkBP,GACvRS,aAAeC,SAAW,SAASC,GAAQ,IAAK,GAAIC,GAAI,EAAGC,EAAIV,KAAKW,OAAQF,EAAIC,EAAGD,IAAO,GAAIA,IAAKT,OAAQA,KAAKS,KAAOD,EAAM,MAAOC,EAAK,QAAO,EAElJhB,QAAS,WACP,YAqBA,SAASA,GAAOmB,GA4Bd,MA3BAZ,MAAKa,OAAS,GAAIC,GAClBd,KAAKe,OAASf,KAAKa,OAAOG,MAAMhB,KAAKe,OAAQH,GAC7CZ,KAAKiB,QAAU,GAAIC,GAAelB,MAClCA,KAAKmB,eAAiB,GAAIA,GAAenB,MACzCA,KAAKoB,SAAW,GAAIA,GAASpB,MAiBzBA,KAAKiB,QAAQI,IAAI,eACnBrB,KAAKe,OAAOO,SAAWtB,KAAKiB,QAAQI,IAAI,cAEtCrB,KAAKiB,QAAQI,IAAI,eACnBrB,KAAKe,OAAOQ,SAAWvB,KAAKiB,QAAQI,IAAI,cAEnCrB,KAhDT,GAAIwB,GAAUV,EAAeM,EAAUD,EAAgBD,CAiTvD,OA/SAzB,GAAOW,UAAUW,QACfU,SAAU,2CACVC,KAAM,cACNC,KAAM,MACNC,SAAU,QACVC,QAAS,KACTC,OAAO,EACPR,UAAU,EACVC,UAAU,EACVQ,QAAS,IACTC,YAAa,mBACbC,MACEC,QAAS,KACTC,IAAK,sBAEPC,SAAU,MAAO,OAAQ,MAAO,WAkClC3C,EAAOW,UAAUiC,aAAe,WAC9B,GAAIC,GAAGC,EAAMC,EAASC,EAASC,EAAGC,CAClC,IAAI3C,KAAKe,OAAOU,SAASd,QAAU,EACjC,KAAM,IAAIiC,OAAM,gCAqBlB,OAnBAL,IACEM,WAAY,WACZC,UAAW9C,KAAKe,OAAOU,UAEzBe,GACEO,eAAgB,qCAElBL,EAAI1C,KAAKmB,eACTwB,EAAI3C,KAAKiB,QACTqB,EAAItC,KAAKe,OACT0B,EAAU,GAAIO,SAAQ,SAASC,EAASC,GACtC,MAAOR,GAAES,KAAKb,EAAEL,KAAKE,IAAK,OAAQI,EAAMC,GAASY,KAAK,SAASb,GAG7D,MAFAI,GAAEU,IAAI,WAAYd,EAAKL,SACvBS,EAAEU,IAAI,SAAUd,EAAKe,cACdL,EAAQV,KACP,MAAE,SAASgB,GACnB,MAAOL,GAAOK,QAMpB9D,EAAOW,UAAUoD,QAAU,SAASrB,EAAKsB,EAAQlB,EAAMC,GACrD,GAAIC,GAASC,EAAGC,CAgBhB,OAfe,OAAXH,IACFA,MAEFE,EAAI1C,KAAKmB,eACTwB,EAAI3C,KAAKiB,QACTwB,EAAU,GAAIO,SAAQ,SAASC,EAASC,GACtC,GAAIQ,EAGJ,OAFAA,GAAQf,EAAEtB,IAAI,UACdmB,EAAuB,cAAI,WAAakB,EACjChB,EAAES,KAAKhB,EAAKsB,EAAQlB,EAAMC,GAASY,KAAK,SAASb,GACtD,MAAOU,GAAQV,KACP,MAAE,SAASgB,GACnB,MAAOL,GAAOK,OAGdZ,EAAEtB,IAAyBsC,KAAKC,OAASjB,EAAEtB,IAAI,aAC1CrB,KAAKqC,aAAae,OAAO,WAC9B,MAAOX,KAGFA,GAIXjB,EAAW,WACT,QAASA,GAASqC,GAChB7D,KAAK6D,EAAIA,EAwBX,MArBArC,GAASpB,UAAU0D,IAAM,SAASC,EAAIC,EAAUT,GAC9C,MAAOvD,MAAK6D,EAAEL,QAAQxD,KAAKiE,SAAW,IAAMF,EAAI,MAAO,KAAMC,EAAUT,IAGzE/B,EAASpB,UAAU8D,KAAO,SAASC,EAAOH,EAAUT,GAClD,MAAOvD,MAAK6D,EAAEL,QAAQxD,KAAKiE,SAAU,MAAOE,EAAOH,EAAUT,IAG/D/B,EAASpB,UAAUgE,KAAO,SAASD,GACjC,MAAOnE,MAAK6D,EAAEL,QAAQxD,KAAKiE,SAAU,MAAOE,IAG9C3C,EAASpB,UAAUiE,OAAS,SAASN,EAAIC,EAAUT,GACjD,GAAIpB,EAKJ,OAJU,OAAN4B,IACFA,EAAK,GAEP5B,EAAMnC,KAAKiE,SAAW,KAAc,IAAPF,EAAWA,EAAK,UAAY,UAClD/D,KAAK6D,EAAEL,QAAQrB,EAAK,MAAO,KAAM6B,EAAUT,IAG7C/B,KAITJ,EAAW,SAAUkD,GAGnB,QAASlD,KACP,MAAOA,GAASf,UAAUJ,YAAYsE,MAAMvE,KAAMwE,WAiBpD,MApBA5E,WAAUwB,EAAUkD,GAMpBlD,EAAShB,UAAU6D,SAAW,WAE9B7C,EAAShB,UAAUqE,OAAS,SAASN,EAAOH,EAAUT,GACpD,MAAOvD,MAAK6D,EAAEL,QAAQxD,KAAKiE,SAAW,UAAW,MAAOE,EAAOH,EAAUT,IAG3EnC,EAAShB,UAAUsE,UAAY,SAASX,EAAIC,EAAUT,GACpD,MAAOvD,MAAK6D,EAAEL,QAAQxD,KAAKiE,SAAW,IAAMF,EAAK,aAAc,MAAO,KAAMC,EAAUT,IAGxFnC,EAAShB,UAAUuE,WAAa,SAASZ,EAAIC,EAAUT,GACrD,MAAOvD,MAAK6D,EAAEL,QAAQxD,KAAKiE,SAAW,IAAMF,EAAK,cAAe,MAAO,KAAMC,EAAUT,IAGlFnC,GAENI,GAEHV,EAAgB,WACd,QAASA,MAoDT,MAlDAA,GAAcV,UAAUY,MAAQ,SAAS4D,EAAIC,GAC3C,GAAIC,GAAGC,EAAIC,CACXD,KACA,KAAKD,IAAKF,GACRI,EAAIJ,EAAGE,GACPC,EAAGD,GAAKE,CAEV,KAAKF,IAAKD,GACRG,EAAIH,EAAGC,GACPC,EAAGD,GAAKE,CAEV,OAAOD,IAGTjE,EAAcV,UAAU6E,QAAU,SAAS/E,EAAKgF,GAC9C,SAAKA,GAAO5E,UAAUH,KAAK+E,EAAKhF,GAAO,IAMzCY,EAAcV,UAAU+E,UAAY,SAASC,EAAKC,GAChD,GAAIP,GAAGQ,EAAKN,CACE,OAAVK,IACFA,EAAS,MAEXC,IACA,KAAKR,IAAKM,GACRJ,EAAII,EAAIN,GACRA,EAAe,OAAXO,EAAkBA,EAAS,IAAMP,EAAI,IAAMA,EAC/CQ,EAAIC,KAAkB,gBAANP,GAAiBhF,KAAKmF,UAAUH,EAAGF,GAAKU,mBAAmBV,GAAK,IAAMU,mBAAmBR,GAE3G,OAAOM,GAAIG,KAAK,MAGlB3E,EAAcV,UAAUwC,MAAQ,SAAS8C,GACvC,GAAIZ,GAAGa,EAAKX,EAAGY,CAEf,IADAD,EAAM,GACyB,kBAApBD,GAASG,OAAuB,CACzCD,EAAOF,EAASG,MAChB,KAAKf,IAAKc,GACRZ,EAAIY,EAAKd,GACTa,GAAOX,EAAI,aAGbW,GAAMD,EAASnC,KAEjB,OAAOvD,MAAKY,QAAQkF,OAAO,QAASH,IAG/B7E,KAITK,EAAiB,WAKf,QAASA,GAAe0C,GACtB,GAAIkC,EACJ/F,MAAK6D,EAAIA,CACT,KACE7D,KAAKgG,OAAS,GAAIC,gBAClB,MAAOC,GACPH,EAAIG,CACJ,KACElG,KAAKgG,OAAS,GAAIG,eAAc,kBAChC,MAAOD,GAEP,KADAH,GAAIG,EACE,GAAItD,OAAM,gCAGpB,MAAO5C,MAlBT,GAAIgG,EA+DJ,OA7DAA,IAAS,EAmBT7E,EAAef,UAAU+C,KAAO,SAAShB,EAAKsB,EAAQlB,EAAMC,GAC1D,GAAIsC,GAAGrC,EAASC,EAAGX,EAASqE,EAAKpB,CACjCvB,GAASA,EAAO4C,cAChBD,EAAMpG,KAAK6D,EAAE9C,OAAOa,SAAW,MAAQ5B,KAAK6D,EAAE9C,OAAOW,MAAgB,uBAARS,EAA+B,IAAMnC,KAAK6D,EAAE9C,OAAOc,QAAU,IAAMM,EAAM,IAAMA,GAC7H,QAAXsB,GACF2C,GAAO,IAAMpG,KAAK6D,EAAEhD,OAAOsE,UAAU5C,GACrCA,EAAO,MAEPA,EAAOvC,KAAK6D,EAAEhD,OAAOsE,UAAU5C,GAEjCvC,KAAKgG,OAAOM,KAAK7C,EAAQ2C,GAAK,GAC9BrE,EAAUwE,WAAW,SAAUC,GAC7B,MAAO,YAEL,MADAA,GAAMR,OAAOS,QACND,EAAMR,OAAOzC,MAAMiD,EAAMR,OAAQ,IAAK,4BAE9ChG,MAAOA,KAAK6D,EAAE9C,OAAOgB,QACxB,KAAK+C,IAAKtC,GACRwC,EAAIxC,EAAQsC,GACZ9E,KAAKgG,OAAOU,iBAAiB5B,EAAGE,EAoBlC,OAlBAtC,GAAI1C,KAAKgG,OACTvD,EAAU,GAAIO,SAAQ,SAASC,EAASC,GACtC,MAAOR,GAAEiE,mBAAqB,WAC5B,GAAIC,GAAKC,CACT,IAAqB,IAAjBnE,EAAEoE,WACJ,MAAO,KAETC,cAAahF,EACb,KAEE,MADA8E,GAAOG,KAAKC,MAAMvE,EAAEwE,cACbjE,EAAQ4D,GACf,MAAOX,GAEP,MADAU,GAAMV,EACChD,EAAO,GAAIN,OAAMgE,QAI9B5G,KAAKgG,OAAOmB,KAAK5E,GACVE,GAGFtB,KAITD,EAAiB,WACf,QAASA,GAAe2C,GACtB7D,KAAK6D,EAAIA,EAeX,MAZA3C,GAAed,UAAUiD,IAAM,SAASnD,EAAKkH,GAC3C,MAAOC,QAAOC,aAAaC,QAAQrH,EAAKkH,IAG1ClG,EAAed,UAAUiB,IAAM,SAASnB,GACtC,MAAOmH,QAAOC,aAAaE,QAAQtH,IAGrCgB,EAAed,UAAkB,OAAI,SAASF,GAC5C,MAAOmH,QAAOC,aAAaG,WAAWvH,IAGjCgB,KAIFzB","file":"moltin.min.js","sourcesContent":["var Moltin,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nMoltin = (function() {\n  \"use strict\";\n  var Abstract, HelperFactory, Products, RequestFactory, StorageFactory;\n\n  Moltin.prototype.config = {\n    clientId: 'umRG34nxZVGIuCSPfYf8biBSvtABgTR8GMUtflyE',\n    host: 'api.molt.in',\n    port: '443',\n    protocol: 'https',\n    version: 'v1',\n    debug: false,\n    currency: false,\n    language: false,\n    timeout: 60000,\n    contentType: 'application/json',\n    auth: {\n      expires: 3600,\n      uri: 'oauth/access_token'\n    },\n    methods: ['GET', 'POST', 'PUT', 'DELETE']\n  };\n\n  function Moltin(options) {\n    this.Helper = new HelperFactory;\n    this.config = this.Helper.Merge(this.config, options);\n    this.Storage = new StorageFactory(this);\n    this.RequestFactory = new RequestFactory(this);\n    this.Products = new Products(this);\n\n    /*\n    @Shipping      = new Shipping @\n    @Tax           = new Tax @\n    @Address       = new Address @\n    @Brand         = new Brand @\n    @Cart          = new Cart @\n    @Category      = new Category @\n    @Checkout      = new Checkout @\n    @Collection    = new Collection @\n    @Currency      = new Currency @\n    @Entry         = new Entry @\n    @Gateway       = new Gateway @\n    @Language      = new Language @\n    @Order         = new Order @\n     */\n    if (this.Storage.get('mcurrency')) {\n      this.config.currency = this.Storage.get('mcurrency');\n    }\n    if (this.Storage.get('mlanguage')) {\n      this.config.language = this.Storage.get('mlanguage');\n    }\n    return this;\n  }\n\n  Moltin.prototype.Authenticate = function() {\n    var c, data, headers, promise, r, s;\n    if (this.config.clientId.length <= 0) {\n      throw new Error(\"You must have a client id set\");\n    }\n    data = {\n      grant_type: 'implicit',\n      client_id: this.config.clientId\n    };\n    headers = {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    };\n    r = this.RequestFactory;\n    s = this.Storage;\n    c = this.config;\n    promise = new Promise(function(resolve, reject) {\n      return r.make(c.auth.uri, 'POST', data, headers).then(function(data) {\n        s.set('mexpires', data.expires);\n        s.set('mtoken', data.access_token);\n        return resolve(data);\n      })[\"catch\"](function(error) {\n        return reject(error);\n      });\n    });\n    return promise;\n  };\n\n  Moltin.prototype.Request = function(uri, method, data, headers) {\n    var promise, r, s;\n    if (headers == null) {\n      headers = {};\n    }\n    r = this.RequestFactory;\n    s = this.Storage;\n    promise = new Promise(function(resolve, reject) {\n      var token;\n      token = s.get('mtoken');\n      headers['Authorization'] = 'Bearer: ' + token;\n      return r.make(uri, method, data, headers).then(function(data) {\n        return resolve(data);\n      })[\"catch\"](function(error) {\n        return reject(error);\n      });\n    });\n    if (s.get('mtoken' === null || Date.now() >= s.get('mexpires'))) {\n      return this.Authenticate.then()(function() {\n        return promise;\n      });\n    } else {\n      return promise;\n    }\n  };\n\n  Abstract = (function() {\n    function Abstract(m) {\n      this.m = m;\n    }\n\n    Abstract.prototype.Get = function(id, callback, error) {\n      return this.m.Request(this.endpoint + '/' + id, 'GET', null, callback, error);\n    };\n\n    Abstract.prototype.Find = function(terms, callback, error) {\n      return this.m.Request(this.endpoint, 'GET', terms, callback, error);\n    };\n\n    Abstract.prototype.List = function(terms) {\n      return this.m.Request(this.endpoint, 'GET', terms);\n    };\n\n    Abstract.prototype.Fields = function(id, callback, error) {\n      var uri;\n      if (id == null) {\n        id = 0;\n      }\n      uri = this.endpoint + '/' + (id !== 0 ? id + '/fields' : 'fields');\n      return this.m.Request(uri, 'GET', null, callback, error);\n    };\n\n    return Abstract;\n\n  })();\n\n  Products = (function(_super) {\n    __extends(Products, _super);\n\n    function Products() {\n      return Products.__super__.constructor.apply(this, arguments);\n    }\n\n    Products.prototype.endpoint = 'products';\n\n    Products.prototype.Search = function(terms, callback, error) {\n      return this.m.Request(this.endpoint + '/search', 'GET', terms, callback, error);\n    };\n\n    Products.prototype.Modifiers = function(id, callback, error) {\n      return this.m.Request(this.endpoint + '/' + id + '/modifiers', 'GET', null, callback, error);\n    };\n\n    Products.prototype.Variations = function(id, callback, error) {\n      return this.m.Request(this.endpoint + '/' + id + '/variations', 'GET', null, callback, error);\n    };\n\n    return Products;\n\n  })(Abstract);\n\n  HelperFactory = (function() {\n    function HelperFactory() {}\n\n    HelperFactory.prototype.Merge = function(o1, o2) {\n      var k, o3, v;\n      o3 = {};\n      for (k in o1) {\n        v = o1[k];\n        o3[k] = v;\n      }\n      for (k in o2) {\n        v = o2[k];\n        o3[k] = v;\n      }\n      return o3;\n    };\n\n    HelperFactory.prototype.InArray = function(key, arr) {\n      if (!arr || __indexOf.call(arr, key) < 0) {\n        return false;\n      }\n      return true;\n    };\n\n    HelperFactory.prototype.Serialize = function(obj, prefix) {\n      var k, str, v;\n      if (prefix == null) {\n        prefix = null;\n      }\n      str = [];\n      for (k in obj) {\n        v = obj[k];\n        k = prefix !== null ? prefix + '[' + k + ']' : k;\n        str.push(typeof v === 'object' ? this.Serialize(v, k) : encodeURIComponent(k) + '=' + encodeURIComponent(v));\n      }\n      return str.join('&');\n    };\n\n    HelperFactory.prototype.Error = function(response) {\n      var k, msg, v, _ref;\n      msg = '';\n      if (typeof response.errors !== 'undefind') {\n        _ref = response.errors;\n        for (k in _ref) {\n          v = _ref[k];\n          msg += v + '<br />';\n        }\n      } else {\n        msg = response.error;\n      }\n      return this.options.notice('Error', msg);\n    };\n\n    return HelperFactory;\n\n  })();\n\n  RequestFactory = (function() {\n    var driver;\n\n    driver = false;\n\n    function RequestFactory(m) {\n      var e;\n      this.m = m;\n      try {\n        this.driver = new XMLHttpRequest();\n      } catch (_error) {\n        e = _error;\n        try {\n          this.driver = new ActiveXObject(\"Msxml2.XMLHTTP\");\n        } catch (_error) {\n          e = _error;\n          throw new Error(\"Request factory boot failed\");\n        }\n      }\n      return this;\n    }\n\n    RequestFactory.prototype.make = function(uri, method, data, headers) {\n      var k, promise, r, timeout, url, v;\n      method = method.toUpperCase();\n      url = this.m.config.protocol + '://' + this.m.config.host + (uri !== 'oauth/access_token' ? '/' + this.m.config.version + '/' + uri : '/' + uri);\n      if (method === 'GET') {\n        url += '?' + this.m.Helper.Serialize(data);\n        data = null;\n      } else {\n        data = this.m.Helper.Serialize(data);\n      }\n      this.driver.open(method, url, true);\n      timeout = setTimeout((function(_this) {\n        return function() {\n          _this.driver.abort();\n          return _this.driver.error(_this.driver, 408, 'Your request timed out');\n        };\n      })(this), this.m.config.timeout);\n      for (k in headers) {\n        v = headers[k];\n        this.driver.setRequestHeader(k, v);\n      }\n      r = this.driver;\n      promise = new Promise(function(resolve, reject) {\n        return r.onreadystatechange = function() {\n          var err, json;\n          if (r.readyState !== 4) {\n            return null;\n          }\n          clearTimeout(timeout);\n          try {\n            json = JSON.parse(r.responseText);\n            return resolve(json);\n          } catch (_error) {\n            err = _error;\n            return reject(new Error(err));\n          }\n        };\n      });\n      this.driver.send(data);\n      return promise;\n    };\n\n    return RequestFactory;\n\n  })();\n\n  StorageFactory = (function() {\n    function StorageFactory(m) {\n      this.m = m;\n    }\n\n    StorageFactory.prototype.set = function(key, value) {\n      return window.localStorage.setItem(key, value);\n    };\n\n    StorageFactory.prototype.get = function(key) {\n      return window.localStorage.getItem(key);\n    };\n\n    StorageFactory.prototype[\"delete\"] = function(key) {\n      return window.localStorage.removeItem(key);\n    };\n\n    return StorageFactory;\n\n  })();\n\n  return Moltin;\n\n})();\n\n//# sourceMappingURL=moltin.js.map\n"]}