{"version":3,"sources":["moltin.js"],"names":["Moltin","options","config","clientId","host","port","protocol","version","debug","currency","language","timeout","contentType","auth","expires","uri","methods","Helper","HelperFactory","Merge","Storage","StorageFactory","RequestFactory","Products","Cart","Orders","Categories","Currency","Brands","Collections","get","length","Error","data","grant_type","client_id","headers","r","s","c","promise","Promise","resolve","reject","make","then","set","access_token","catch","error","method","t","req","token","Date","now","toString","Authenticate","Abstract","m","id","params","endpoint","Request","cartId","includes","terms","callback","Identifier","reset","replace","Math","random","product","quantity","productObject","parseInt","quantityInt","request","err","o1","o2","o3","k","v","key","arr","__in__","obj","prefix","str","push","Serialize","encodeURIComponent","join","response","msg","errors","notice","needle","haystack","indexOf","driver","XMLHttpRequest","e","ActiveXObject","console","log","toUpperCase","url","JSON","stringify","open","setTimeout","abort","setRequestHeader","onreadystatechange","readyState","clearTimeout","json","parse","responseText","send","value","window","localStorage","setItem","getItem","removeItem"],"mappings":"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","file":"moltin.js","sourcesContent":["class Moltin {\n  \"use strict\";\n\n  constructor(options) {\n    this.config = {\n      clientId: 'umRG34nxZVGIuCSPfYf8biBSvtABgTR8GMUtflyE',\n      host: 'api-dev.moltin.com',\n      port: '443',\n      protocol: 'http',\n      version: 'v2',\n      debug: false,\n      currency: false,\n      language: false,\n      timeout: 60000,\n      contentType: 'application/json',\n      auth: {\n        expires: 3600,\n        uri: 'oauth/access_token'\n      },\n      methods: ['GET', 'POST', 'PUT', 'DELETE']\n    };\n\n    this.Helper         = new HelperFactory();\n    this.config         = this.Helper.Merge(this.config, options);\n\n    this.Storage        = new StorageFactory(this);\n    this.RequestFactory = new RequestFactory(this);\n\n    this.Products       = new Products(this);\n    this.Cart           = new Cart(this);\n    this.Orders         = new Orders(this);\n    this.Categories     = new Categories(this);\n    this.Currency       = new Currency(this);\n    this.Brands         = new Brands(this);\n    this.Collections    = new Collections(this);\n\n    /*\n    @Shipping      = new Shipping @\n    @Tax           = new Tax @\n    @Address       = new Address @\n    @Brand         = new Brand @\n    @Checkout      = new Checkout @\n    @Entry         = new Entry @\n    @Gateway       = new Gateway @\n    @Language      = new Language @\n    */\n\n    if (this.Storage.get('mcurrency')) {\n      this.config.currency = this.Storage.get('mcurrency');\n    }\n\n    if (this.Storage.get('mlanguage')) {\n      this.config.language = this.Storage.get('mlanguage');\n    }\n\n    return this;\n  }\n\n  Authenticate() {\n    // Check Client ID is set\n    if (this.config.clientId.length <= 0) {\n      throw new Error(\"You must have a client id set\");\n    }\n\n    let data = {\n      grant_type: 'implicit',\n      client_id:  this.config.clientId\n    };\n\n    let headers = {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    };\n\n    let r = this.RequestFactory;\n    let s = this.Storage;\n    let c = this.config;\n\n    let promise = new Promise((resolve, reject) =>\n\n      r.make(c.auth.uri, 'POST', data, headers)\n      .then(function(data) {\n        s.set('mexpires', data.expires);\n        s.set('mtoken', data.access_token);\n        return resolve(data);\n      })\n      .catch(error => reject(error))\n    );\n\n    return promise;\n  }\n\n  Request(uri, method, data, headers = {}) {\n    let r = this.RequestFactory;\n    let s = this.Storage;\n    let t = this;\n\n    let promise = new Promise(function(resolve, reject) {\n      let req = function() {\n        let token = s.get('mtoken');\n\n        headers = {\n          'Authorization': `Bearer: ${token}`,\n          'Content-Type': t.config.contentType\n        };\n\n        if (t.config.currency) {\n          headers['X-MOLTIN-CURRENCY'] = t.config.currency;\n        }\n\n        return r.make(uri, method, data, headers)\n        .then(data => resolve(data)).catch(error => reject(error));\n      };\n\n      if (!s.get('mtoken') || Date.now().toString() >= s.get('mexpires')) {\n        return t.Authenticate()\n        .then(req).catch(error => reject(error));\n      } else {\n        req();\n      }\n    });\n\n    return promise;\n  }\n}\n\nclass Abstract {\n  constructor(m) {\n    this.m = m;\n  }\n\n  Get(id, params) {\n    if (this.endpoint === 'carts') {\n      return this.m.Request(`${this.endpoint}/${this.cartId}`, 'GET');\n    }\n\n    if (params) {\n      const includes = params.toString();\n\n      return this.m.Request(`${this.endpoint}/${id}?include=${includes}`, 'GET');\n    }\n\n    return this.m.Request(`${this.endpoint}/${id}`, 'GET');\n  }\n\n  Find(terms, callback, error) {\n    return this.m.Request(this.endpoint, 'GET', terms, callback, error);\n  }\n\n  List(params) {\n    if (params) {\n      const includes = params.toString();\n\n      return this.m.Request(`${this.endpoint}?include=${includes}`, 'GET');\n    }\n\n    return this.m.Request(this.endpoint, 'GET');\n  }\n\n  Fields(callback, error) {\n    let id = 0;\n    let uri  = this.endpoint+'/'+ (id !== 0 ? id+'/fields' : 'fields');\n\n    return this.m.Request(uri, 'GET', null, callback, error);\n  }\n}\n\nclass Brands extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'brands';\n  }\n}\n\nclass Cart extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'carts';\n    this.cartId = this.Identifier();\n  }\n\n  Identifier(reset = false, id = false) {\n\n    if (!reset && !id && this.m.Storage.get('mcart') !== null) {\n      return this.m.Storage.get('mcart');\n    }\n\n    if (!id) {\n      id = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'.replace(/[x]/g, () => (Math.random() * 16 | 0).toString(16));\n    }\n\n    this.m.Storage.set('mcart', id);\n\n    this.cartId = id;\n\n    return id;\n  }\n\n  Contents(callback, error) {\n    return this.m.Request(`${this.endpoint}/${this.cartId}/items`, 'GET', callback, error);\n  }\n\n  Insert(product, quantity, callback, error) {\n    const productObject = {\n      id: product,\n      quantity: parseInt(quantity) || 1\n    };\n\n    return this.m.Request(`${this.endpoint}/${this.cartId}/items`, 'POST', productObject, callback, error);\n  }\n\n  Remove(id, callback, error) {\n    return this.m.Request(`${this.endpoint}/${this.cartId}/items/${id}`, 'DELETE', callback, error);\n  }\n\n  Quantity(id, quantity, callback, error) {\n    let quantityInt = parseInt(quantity);\n\n    return this.m.Request(`${this.endpoint}/${this.cartId}/items/${id}`, 'PUT', [{\n      id: id,\n      quantity: quantityInt\n    }], callback, error);\n  }\n\n  Complete(data, callback, error) {\n    return this.m.Request(`${this.endpoint}/${this.cartId}/checkout`, 'POST', data, callback, error);\n  }\n\n  Delete(callback, error) {\n    return this.m.Request(`${this.endpoint}/${this.cartId}`, 'DELETE', callback, error);\n  }\n}\n\nclass Categories extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'categories';\n  }\n\n  Tree(error, callback) {\n    return this.m.Request(`${this.endpoint}/tree`, 'GET', error, callback);\n  }\n}\n\nclass Collections extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'collections';\n  }\n}\n\nclass Currency extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'currencies';\n  }\n\n  Set(currency) {\n    this.m.Storage.set('mcurrency', currency);\n    this.m.config.currency = currency;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = this.m.Storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch(err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n\n  Active() {\n    const promise = new Promise((resolve, reject) => {\n      const request = this.m.Storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch(err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n}\n\nclass Orders extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'orders';\n  }\n\n  Payment(id, data, callback, error) {\n    return this.m.Request(`${this.endpoint}/${id}/payments`, 'POST', data, callback, error);\n  }\n}\n\nclass Products extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'products';\n  }\n\n  Search(terms, callback, error) {\n    return this.m.Request(this.endpoint+'/search', 'GET', terms, callback, error);\n  }\n\n  Modifiers(id, callback, error) {\n    return this.m.Request(this.endpoint+'/'+id+'/modifiers', 'GET', null, callback, error);\n  }\n\n  Variations(id, callback, error) {\n    return this.m.Request(this.endpoint+'/'+id+'/variations', 'GET', null, callback, error);\n  }\n}\n\nclass HelperFactory {\n  constructor() {}\n\n  Merge(o1, o2) {\n    let o3 = {};\n\n    for (var k in o1) { var v = o1[k]; o3[k] = v; }\n    for (k in o2) { var v = o2[k]; o3[k] = v; }\n\n    return o3;\n  }\n\n  InArray(key, arr) {\n    if (!arr || !__in__(key, arr)) { return false; }\n\n    return true;\n  }\n\n  Serialize(obj, prefix = null) {\n    let str = [];\n\n    for (let k in obj) {\n      let v = obj[k];\n\n      k = prefix !== null ? prefix+'['+k+']' : k;\n      str.push(typeof v === 'object' ? this.Serialize(v, k) : encodeURIComponent(k)+'='+encodeURIComponent(v));\n    }\n\n    return str.join('&');\n  }\n\n  Error(response) {\n    let msg = '';\n\n    if (typeof response.errors !== 'undefined') {\n      for (let k in response.errors) { let v = response.errors[k]; msg += v+'<br />'; }\n    } else {\n      msg = response.error;\n    }\n\n    return this.options.notice('Error', msg);\n  }\n}\n\nfunction __in__(needle, haystack) {\n  return haystack.indexOf(needle) >= 0;\n}\n\nclass RequestFactory {\n  constructor(m) {\n    this.driver = false;\n    this.m = m;\n\n    try {\n      this.driver = new XMLHttpRequest();\n    } catch (e) {\n      try {\n        this.driver = new ActiveXObject(\"Msxml2.XMLHTTP\");\n      } catch (e) {\n        throw new Error(\"Request factory boot failed\");\n      }\n    }\n\n    return this;\n  }\n\n  make(uri, method, data, headers) {\n    console.log(data);\n    method = method.toUpperCase();\n    let url = this.m.config.protocol + '://' + this.m.config.host +\n      ( uri !== 'oauth/access_token' ? `/${this.m.config.version}/${uri}` : `/${uri}` );\n\n    if ( method === 'POST' || method === 'PUT' ) {\n      data = ( uri === 'oauth/access_token' ? this.m.Helper.Serialize(data) : `{\"data\":${JSON.stringify(data)}}`);\n    }\n\n    this.driver.open(method, url, true);\n\n    let timeout = setTimeout(() => {\n      this.driver.abort();\n      return this.driver.error(this.driver, 408, 'Your request timed out');\n    }, this.m.config.timeout);\n\n    for (let k in headers) { let v = headers[k]; this.driver.setRequestHeader(k, v); }\n\n    let r = this.driver;\n    let promise = new Promise((resolve, reject) =>\n\n      r.onreadystatechange = function() {\n\n        if (r.readyState !== 4) {\n          return null;\n        }\n\n        clearTimeout(timeout);\n\n        try {\n          let json = JSON.parse(r.responseText);\n          return resolve(json);\n        } catch (err) {\n          return reject(new Error(err));\n        }\n      }\n    );\n\n    this.driver.send(data);\n\n    return promise;\n  }\n}\n\nclass StorageFactory {\n  constructor(m) {\n    this.m = m;\n  }\n\n  set(key, value) {\n    return window.localStorage.setItem(key, value);\n  }\n\n  get(key) {\n    return window.localStorage.getItem(key);\n  }\n\n  delete(key) {\n    return window.localStorage.removeItem(key);\n  }\n}\n"]}