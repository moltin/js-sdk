{"version":3,"sources":["moltin.js"],"names":["Moltin","options","config","clientId","host","port","protocol","version","debug","currency","language","timeout","contentType","auth","expires","uri","methods","Helper","HelperFactory","Merge","Storage","StorageFactory","RequestFactory","Products","get","length","Error","data","grant_type","client_id","headers","r","s","c","promise","Promise","resolve","reject","make","then","set","access_token","catch","error","method","t","req","token","Date","now","toString","Authenticate","Abstract","m","id","callback","Request","endpoint","terms","o1","o2","o3","k","v","key","arr","__in__","obj","prefix","str","push","Serialize","encodeURIComponent","join","response","msg","errors","notice","needle","haystack","indexOf","driver","XMLHttpRequest","e","ActiveXObject","toUpperCase","url","open","setTimeout","abort","setRequestHeader","onreadystatechange","readyState","clearTimeout","json","JSON","parse","responseText","err","send","value","window","localStorage","setItem","getItem","removeItem"],"mappings":"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","file":"moltin.js","sourcesContent":["class Moltin {\n  \"use strict\";\n\n  constructor(options) {\n    this.config = {\n      clientId: 'umRG34nxZVGIuCSPfYf8biBSvtABgTR8GMUtflyE',\n      host: 'api.molt.in',\n      port: '443',\n      protocol: 'https',\n      version: 'v1',\n      debug: false,\n      currency: false,\n      language: false,\n      timeout: 60000,\n      contentType: 'application/json',\n      auth: {\n        expires: 3600,\n        uri: 'oauth/access_token'\n      },\n      methods: ['GET', 'POST', 'PUT', 'DELETE']\n    };\n\n    this.Helper = new HelperFactory();\n    this.config = this.Helper.Merge(this.config, options);\n\n    this.Storage = new StorageFactory(this);\n    this.RequestFactory = new RequestFactory(this);\n\n\n    this.Products      = new Products(this);\n\n    /*\n    @Shipping      = new Shipping @\n    @Tax           = new Tax @\n    @Address       = new Address @\n    @Brand         = new Brand @\n    @Cart          = new Cart @\n    @Category      = new Category @\n    @Checkout      = new Checkout @\n    @Collection    = new Collection @\n    @Currency      = new Currency @\n    @Entry         = new Entry @\n    @Gateway       = new Gateway @\n    @Language      = new Language @\n    @Order         = new Order @\n    */\n\n    if (this.Storage.get('mcurrency')) {\n      this.config.currency = this.Storage.get('mcurrency');\n    }\n\n    if (this.Storage.get('mlanguage')) {\n      this.config.language = this.Storage.get('mlanguage');\n    }\n\n    return this;\n  }\n\n  Authenticate() {\n    // Check Client ID is set\n    if (this.config.clientId.length <= 0) {\n      throw new Error(\"You must have a client id set\");\n    }\n\n    let data = {\n      grant_type: 'implicit',\n      client_id:  this.config.clientId\n    };\n\n    let headers =\n      {'Content-Type': 'application/x-www-form-urlencoded'};//@config.contentType\n\n    let r = this.RequestFactory;\n    let s = this.Storage;\n    let c = this.config;\n\n    let promise = new Promise((resolve, reject) =>\n\n      r.make(c.auth.uri, 'POST', data, headers)\n      .then(function(data) {\n        s.set('mexpires', data.expires);\n        s.set('mtoken', data.access_token);\n        return resolve(data);\n      })\n      .catch(error => reject(error))\n    );\n\n    return promise;\n  }\n\n  Request(uri, method, data, headers = {}) {\n    let r = this.RequestFactory;\n    let s = this.Storage;\n    let t = this;\n\n    let promise = new Promise(function(resolve, reject) {\n      let req = function() {\n        let token = s.get('mtoken');\n        headers['Authorization'] = `Bearer: ${token}`;\n\n        return r.make(uri, method, data, headers)\n        .then(data => resolve(data)).catch(error => reject(error));\n      };\n\n      if (!s.get('mtoken') || Date.now().toString() >= s.get('mexpires')) {\n        return t.Authenticate()\n        .then(req).catch(error => reject(error));\n      } else {\n        req();\n      }\n    });\n\n    return promise;\n  }\n}\n\nclass Abstract {\n  constructor(m) {\n    this.m = m;\n  }\n\n  Get(id, callback, error) {\n    return this.m.Request(this.endpoint+'/'+id, 'GET', null, callback, error);\n  }\n\n  Find(terms, callback, error) {\n    return this.m.Request(this.endpoint, 'GET', terms, callback, error);\n  }\n\n  List(terms) {\n    return this.m.Request(this.endpoint, 'GET', terms);\n  }\n\n  Fields(callback, error) {\n    let id = 0;\n    let uri  = this.endpoint+'/'+ (id !== 0 ? id+'/fields' : 'fields');\n\n    return this.m.Request(uri, 'GET', null, callback, error);\n  }\n}\n\nclass Products extends Abstract {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'products';\n  }\n\n  Search(terms, callback, error) {\n    return this.m.Request(this.endpoint+'/search', 'GET', terms, callback, error);\n  }\n\n  Modifiers(id, callback, error) {\n    return this.m.Request(this.endpoint+'/'+id+'/modifiers', 'GET', null, callback, error);\n  }\n\n  Variations(id, callback, error) {\n    return this.m.Request(this.endpoint+'/'+id+'/variations', 'GET', null, callback, error);\n  }\n}\n\nclass HelperFactory {\n  constructor() {}\n\n  Merge(o1, o2) {\n    let o3 = {};\n\n    for (var k in o1) { var v = o1[k]; o3[k] = v; }\n    for (k in o2) { var v = o2[k]; o3[k] = v; }\n\n    return o3;\n  }\n\n  InArray(key, arr) {\n    if (!arr || !__in__(key, arr)) { return false; }\n\n    return true;\n  }\n\n  Serialize(obj, prefix = null) {\n    let str = [];\n\n    for (let k in obj) {\n      let v = obj[k];\n\n      k = prefix !== null ? prefix+'['+k+']' : k;\n      str.push(typeof v === 'object' ? this.Serialize(v, k) : encodeURIComponent(k)+'='+encodeURIComponent(v));\n    }\n\n    return str.join('&');\n  }\n\n  Error(response) {\n    let msg = '';\n\n    if (typeof response.errors !== 'undefined') {\n      for (let k in response.errors) { let v = response.errors[k]; msg += v+'<br />'; }\n    } else {\n      msg = response.error;\n    }\n\n    return this.options.notice('Error', msg);\n  }\n}\n\nfunction __in__(needle, haystack) {\n  return haystack.indexOf(needle) >= 0;\n}\n\nclass RequestFactory {\n  constructor(m) {\n    this.driver = false;\n    this.m = m;\n\n    try {\n      this.driver = new XMLHttpRequest();\n    } catch (e) {\n      try {\n        this.driver = new ActiveXObject(\"Msxml2.XMLHTTP\");\n      } catch (e) {\n        throw new Error(\"Request factory boot failed\");\n      }\n    }\n\n    return this;\n  }\n\n  make(uri, method, data, headers) {\n    method = method.toUpperCase();\n    let url = this.m.config.protocol + '://' + this.m.config.host +\n      ( uri !== 'oauth/access_token' ? `/${this.m.config.version}/${uri}` : `/${uri}` );\n\n    if (method === 'GET') {\n      url += `?${this.m.Helper.Serialize(data)}`;\n      data = null;\n    } else {\n      data = this.m.Helper.Serialize(data);\n    }\n\n    this.driver.open(method, url, true);\n\n    let timeout = setTimeout(() => {\n      this.driver.abort();\n      return this.driver.error(this.driver, 408, 'Your request timed out');\n    }, this.m.config.timeout);\n\n    for (let k in headers) { let v = headers[k]; this.driver.setRequestHeader(k, v); }\n\n    let r = this.driver;\n    let promise = new Promise((resolve, reject) =>\n\n      r.onreadystatechange = function() {\n\n        if (r.readyState !== 4) {\n          return null;\n        }\n\n        clearTimeout(timeout);\n\n        try {\n          let json = JSON.parse(r.responseText);\n          return resolve(json);\n        } catch (err) {\n          return reject(new Error(err));\n        }\n      }\n    );\n\n    this.driver.send(data);\n\n    return promise;\n  }\n}\n\nclass StorageFactory {\n  constructor(m) {\n    this.m = m;\n  }\n\n  set(key, value) {\n    return window.localStorage.setItem(key, value);\n  }\n\n  get(key) {\n    return window.localStorage.getItem(key);\n  }\n\n  delete(key) {\n    return window.localStorage.removeItem(key);\n  }\n}\n"]}